[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-07-04 14:59:09.246691",
  "module": null,
  "name": "根据物料组生成物料编码",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Item",
  "script": "# 定义我们要查找和替换的“暗号”或占位符\r\nplaceholder = \".{__item_group_code__}.\"\r\n\r\n# 检查当前物料的命名模板里是否包含了我们定义的“暗号”\r\nif doc.naming_series and placeholder in doc.naming_series:\r\n    \r\n    # 默认替换成空字符串，以防物料组或代码没填\r\n    group_code_str = \"\"\r\n\r\n    # 检查用户是否选了物料组\r\n    if doc.item_group:\r\n        # 从数据库里获取物料组对应的代码\r\n        fetched_code = frappe.db.get_value(\"Item Group\", doc.item_group, \"custom_item_group_code\")\r\n        \r\n        # 如果成功拿到了代码，就把它存起来\r\n        if fetched_code:\r\n            group_code_str = str(fetched_code)\r\n\r\n    # 核心步骤：用拿到的代码替换掉模板里的“暗号”\r\n    # 比如，把 \".{item_group_code}.-.#####\" 变成 \"10.-.#####\"\r\n    new_naming_series = doc.naming_series.replace(placeholder, group_code_str)\r\n\r\n    # 把修改后的新模板再写回给系统\r\n    # 这样，系统接下来就会用 \"10.-.#####\" 这个模板去生成最终的流水号\r\n    doc.naming_series = new_naming_series",
  "script_type": "DocType Event"
 }
]